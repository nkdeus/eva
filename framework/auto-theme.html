<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.9.1/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.9.1/ScrollTrigger.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.9.1/Draggable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/color-thief/2.3.0/color-thief.umd.js"></script>
    <script>
      // Embedded OKLCH conversion - scientific accuracy
      function rgbToOklch(r, g, b) {
        // Normalize RGB values
        r = r / 255;
        g = g / 255;
        b = b / 255;

        // Convert sRGB to linear RGB
        const toLinear = (c) => c > 0.04045 ? Math.pow((c + 0.055) / 1.055, 2.4) : c / 12.92;
        const lr = toLinear(r);
        const lg = toLinear(g);
        const lb = toLinear(b);

        // Convert linear RGB to OKLab
        const l = 0.4122214708 * lr + 0.5363325363 * lg + 0.0514459929 * lb;
        const m = 0.2119034982 * lr + 0.6806995451 * lg + 0.1073969566 * lb;
        const s = 0.0883024619 * lr + 0.2817188376 * lg + 0.6299787005 * lb;

        const l_ = Math.cbrt(l);
        const m_ = Math.cbrt(m);
        const s_ = Math.cbrt(s);

        const L = 0.2104542553 * l_ + 0.7936177850 * m_ - 0.0040720468 * s_;
        const a = 1.9779984951 * l_ - 2.4285922050 * m_ + 0.4505937099 * s_;
        const b_ = 0.0259040371 * l_ + 0.7827717662 * m_ - 0.8086757660 * s_;

        // Convert OKLab to OKLCH
        const lightness = L;
        const chroma = Math.sqrt(a * a + b_ * b_);
        let hue = Math.atan2(b_, a) * 180 / Math.PI;
        if (hue < 0) hue += 360;

        return {
          l: Math.round(lightness * 100 * 100) / 100,
          c: Math.round(chroma * 1000) / 1000,
          h: Math.round(hue * 100) / 100
        };
      }
      
      function hexToOklch(hex) {
        const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
        if (!result) return { l: 50, c: 0.1, h: 0 };

        const r = parseInt(result[1], 16);
        const g = parseInt(result[2], 16);
        const b = parseInt(result[3], 16);

        return rgbToOklch(r, g, b);
      }
    </script>
    <link rel="stylesheet" href="https://use.typekit.net/vjo0ssd.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Display:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../styles/main.css" />
    <script defer src="https://cloud.umami.is/script.js" data-website-id="3c9b4552-d24d-48aa-a6b4-877d0ceffe04"></script>
    <title>EVA CSS - Auto Theme Generator</title>
  </head>
  <body class="current-theme theme-eva all-grads toggle-theme">
  <a href="" class="dark-light-toggle no-hover">
    <svg xmlns="http://www.w3.org/2000/svg" data-name="Layer 1" viewBox="0 0 100 100" x="0px" y="0px"><path d="M50,77.62A27.62,27.62,0,1,0,22.38,50,27.61,27.61,0,0,0,50,77.62ZM50,26A24,24,0,1,1,26,50,24,24,0,0,1,50,26ZM69.62,50.52A19.36,19.36,0,0,0,50.26,31.15V69.88A19.36,19.36,0,0,0,69.62,50.52Zm-19.88,31a1.81,1.81,0,0,0-1.81,1.81V95.69a1.81,1.81,0,0,0,3.62,0V83.3A1.81,1.81,0,0,0,49.74,81.49Zm24.9-9A1.81,1.81,0,0,0,72.09,75l8.76,8.76a1.81,1.81,0,0,0,2.55-2.56Zm6.85-22.19a1.81,1.81,0,0,0,1.81,1.81H95.69a1.81,1.81,0,1,0,0-3.62H83.3A1.81,1.81,0,0,0,81.49,50.26ZM75,27.91l8.76-8.76a1.81,1.81,0,0,0-2.56-2.55l-8.76,8.76A1.81,1.81,0,0,0,75,27.91Zm-24.75-9.4a1.81,1.81,0,0,0,1.81-1.81V4.31a1.81,1.81,0,0,0-3.62,0V16.7A1.81,1.81,0,0,0,50.26,18.51Zm-24.9,9A1.81,1.81,0,0,0,27.91,25l-8.76-8.76a1.81,1.81,0,1,0-2.55,2.56Zm-21,24H16.7a1.81,1.81,0,0,0,0-3.62H4.31a1.81,1.81,0,1,0,0-3.62Zm22,20a1.78,1.78,0,0,0-1.28.53l-8.76,8.76a1.8,1.8,0,0,0,0,2.56,1.82,1.82,0,0,0,2.56,0l8.76-8.77a1.81,1.81,0,0,0-1.28-3.08Z"/></svg>
  </a>
  <nav id="nav" class="px-220__ flex space py-12- pof">
    <div id="logo" class="flex x center px-20">
      <div class="ballzzz por" style="--max:6">
        <div class="ball poa ar-1 circle _bg-brand" style="--offset:0"></div>
        <div class="ball poa ar-1 circle _bg-brand" style="--offset:1"></div>
        <div class="ball poa ar-1 circle _bg-brand" style="--offset:2"></div>
        <div class="ball poa ar-1 circle _bg-brand" style="--offset:3"></div>
        <div class="ball poa ar-1 circle _bg-brand" style="--offset:4"></div>
        <div class="ball poa ar-1 circle _bg-brand" style="--offset:5"></div>
      </div>
      <a href="../index.html" class="logo no-hover title fs-36__ lh-1">EVA CSS</a>
    </div>
    
    <!-- Burger menu button -->
    <button id="burger-menu" class="burger-menu">
      <span class="burger-line"></span>
      <span class="burger-line"></span>
      <span class="burger-line"></span>
    </button>
    
    <div id="menu" class="flex x center g-12">
      
      <div class="inner-menu">
        <a href="../framework.html" class="h-52 px-12 flex y center _c-brand br-12">
          <span class="fs-12">Framework</span>
        </a>
        <ul>
          <li>
            <a href="../framework/colors.html" class="h-52 px-12 flex y center _c-brand br-12">
              <span class="fs-12">Colors</span>
            </a>
          </li>
          <li>
            <a href="../framework/gradients.html" class="h-52 px-12 flex y center _c-brand br-12">
              <span class="fs-12">Gradients</span>
            </a>
          </li>
          <li>
            <a href="../framework/grids.html" class="h-52 px-12 flex y center _c-brand br-12">
              <span class="fs-12">Grids</span>
            </a>
          </li>
          <li>
            <a href="../framework/css-fluid.html" class="h-52 px-12 flex y center _c-brand br-12">
              <span class="fs-12">Fluid CSS</span>
            </a>
          </li>
          <li>
            <a href="../framework/doc.html" class="h-52 px-12 flex y center _c-brand br-12">
              <span class="fs-12">Docs</span>
            </a>
          </li>  
          <li>
            <a href="../framework/auto-theme.html" class="h-52 px-12 flex y center _c-brand br-12">
              <span class="fs-12">Auto theme</span>
            </a>
          </li>  
          <li>
            <a href="../framework/js-calculator.html" class="h-52 px-12 flex y center _c-brand br-12">
              <span class="fs-12">JS Calculator</span>
            </a>
          </li>     
        </ul>
      </div>
      <a href="../figma-to-eva.html" class="h-52 px-12 flex y center _c-brand br-12">
        <span class="fs-12">Figma to EVA</span>
      </a>


      <a href="https://github.com/nkdeus/eva" target="_blank" class="h-52 px-8 flex x g-12 center _c-brand br-8">
       
        <svg xmlns="http://www.w3.org/2000/svg" class="lh-0" height="20" viewBox="0 0 16 16" width="20" aria-hidden="true" class="d-block"><path fill="currentColor" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"></path></svg>
      </a>

    </div>

  </nav>

  <section class="px-220__ pt-220- pb-136 flex y g-32">
      <p class="fs-36_ py-52- flex y g-20">
        <h1 class="fs-52__ lh-1 ttu">
          <span>Auto <span class="title grad-linear-text grad-linear from-accent to-extra">Theme</span> Generator</span>
        </h1>
        <p class="fs-16">
          Upload an image and automatically generate an EVA CSS theme from its dominant colors
        </p>
      </p>
  </section>

  <section class="px-220__ py-136 flex y g-136">
    
    <!-- Drop Zone -->
    <div class="flex y g-20">
      <h2 class="fs-24 bold">Upload Image</h2>
      <div id="drop-zone" class="w-full h-300 _bg-light br-12 flex y center g-20 p-32" style="border: 2px dashed var(--brand); transition: all 0.3s ease;">
        <div class="flex y center g-12">
          <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="_c-brand">
            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
            <polyline points="7,10 12,15 17,10"/>
            <line x1="12" y1="15" x2="12" y2="3"/>
          </svg>
          <p class="fs-16 _c-brand bold">Drop image here or click to select</p>
          <p class="fs-12 _c-brand_">Supports JPG, PNG, GIF, WebP</p>
        </div>
        <input type="file" id="file-input" accept="image/*" class="hide" />
      </div>
    </div>

    <!-- Preview Section -->
    <div id="preview-section" class="flex y g-20 hide">
      <h2 class="fs-24 bold">Image Preview</h2>
      <div class="flex wrap g-20">
        <div class="flex y g-12">
          <img id="preview-image" class="w-300 h-auto br-12" />
        </div>
      </div>
    </div>

    <!-- Color Palette -->
    <div id="color-palette" class="flex y g-20 hide">
      <h2 class="fs-24 bold">Extracted Colors</h2>
      <div id="color-swatches" class="flex wrap g-12">
        <!-- Color swatches will be generated here -->
      </div>
    </div>

    <!-- Theme Assignment -->
    <div id="theme-assignment" class="flex y g-20 hide">
      <h2 class="fs-24 bold">Theme Assignment</h2>
      <div class="flex y g-12">
        <p class="fs-12 _c-dark_">Click on a theme variable to select its color</p>
        <div id="theme-mapping" class="flex wrap g-12">
          <!-- Theme assignment will be generated here -->
        </div>
      </div>
    </div>

    <!-- Color Picker Modal -->
    <div id="color-picker-modal" class="color-picker-modal hide">
      <div class="color-picker-overlay"></div>
      <div class="color-picker-content">
        <div class="flex y g-20">
          <div class="flex x space center">
            <h3 id="picker-title" class="fs-18 bold">Select color for brand</h3>
            <button id="close-picker" class="fs-20 _c-brand">✕</button>
          </div>
          <div class="flex wrap g-20" id="color-picker-swatches">
            <!-- Color options will be generated here -->
          </div>
          
        </div>
      </div>
    </div>

    <!-- Generated Theme -->
    <div id="generated-theme" class="flex y g-20 hide">
      <h2 class="fs-24 bold">Generated Theme</h2>
      <div class="flex y g-12">
        <div class="px-20 py-20 _bg-dark br-12">
          <pre id="theme-css" class="fs-12 _c-light"></pre>
        </div>
        <div class="flex wrap g-12">
          <button id="copy-theme" class="px-12 py-8 _c-brand br-8 fs-12 bold">Copy CSS</button>
          <button id="reset-theme" class="px-12 py-8 _c-accent br-8 fs-12 bold">Reset Theme</button>
        </div>
      </div>
    </div>


  </section>

  <div class="stage">
    <div class="flex stage-top">
      <div class="line-y h-4"></div>
      <div class="line-y h-8"></div>
      <div class="line-y h-12"></div>
      <div class="line-y h-20"></div>
      <div class="line-y h-32"></div>
      <div class="line-y h-34"></div>
      <div class="line-y h-52"></div>
      <div class="line-y h-84"></div>
      <div class="line-y h-136"></div>
      <div class="line-y h-220"></div>
      <div class="line-y h-356"></div>
      <div class="line-y h-220"></div>
      <div class="line-y h-136"></div>
      <div class="line-y h-84"></div>
      <div class="line-y h-52"></div>
      <div class="line-y h-34"></div>
      <div class="line-y h-32"></div>
      <div class="line-y h-20"></div>
      <div class="line-y h-12"></div>
      <div class="line-y h-8"></div>
      <div class="line-y h-4"></div>
    </div>
  </div>

  <footer class="px-220__ py-136 flex x g-20 w-full">
    <div class="flex w-full y space center g-32">
      <p class="fs-12_ _c-brand_">© 2024</p>
      <p class="fs-12_ _c-brand_">Tati Michaël</p>
    </div>
    <div class="flex w-full y space g-32">
      <a href="https://www.linkedin.com/in/mtati/" target="_blank">LinkedIn</a>
      <a href="https://ulysse-2029.com/" target="_blank">ulysse-2029.com</a>
    </div>
  </footer>

  <script src="../app.js"></script>
  
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Using embedded OKLCH conversion (scientific accuracy)
      const dropZone = document.getElementById('drop-zone');
      const fileInput = document.getElementById('file-input');
      const previewSection = document.getElementById('preview-section');
      const previewImage = document.getElementById('preview-image');
      const colorPalette = document.getElementById('color-palette');
      const colorSwatches = document.getElementById('color-swatches');
      const themeAssignment = document.getElementById('theme-assignment');
      const themeMapping = document.getElementById('theme-mapping');
      const generatedTheme = document.getElementById('generated-theme');
      const themeCss = document.getElementById('theme-css');
      const copyTheme = document.getElementById('copy-theme');
      const applyTheme = document.getElementById('apply-theme');
      const colorPreview = document.getElementById('color-preview');
      
      const colorThief = new ColorThief();
      let extractedColors = [];
      let themeColors = {
        brand: null,
        accent: null,
        extra: null,
        dark: null,
        light: null
      };
      
      // Drop zone events
      dropZone.addEventListener('click', () => fileInput.click());
      dropZone.addEventListener('dragover', (e) => {
        e.preventDefault();
        dropZone.style.borderColor = 'var(--accent)';
        dropZone.style.backgroundColor = 'var(--accent___)';
      });
      dropZone.addEventListener('dragleave', () => {
        dropZone.style.borderColor = 'var(--brand)';
        dropZone.style.backgroundColor = 'var(--light)';
      });
      dropZone.addEventListener('drop', (e) => {
        e.preventDefault();
        dropZone.style.borderColor = 'var(--brand)';
        dropZone.style.backgroundColor = 'var(--light)';
        const file = e.dataTransfer.files[0];
        if (file && file.type.startsWith('image/')) {
          handleImageUpload(file);
        }
      });
      
      fileInput.addEventListener('change', (e) => {
        const file = e.target.files[0];
        if (file) {
          handleImageUpload(file);
        }
      });
      
      function handleImageUpload(file) {
        const reader = new FileReader();
        reader.onload = function(e) {
          previewImage.src = e.target.result;
          previewImage.onload = function() {
            previewSection.classList.remove('hide');
            // Séquencer le travail pour éviter les blocages
          setTimeout(() => {
            extractColors();
          }, 100);
          };
        };
        reader.readAsDataURL(file);
      }
      
      function extractColors() {
        try {
          const palette = colorThief.getPalette(previewImage, 8);
          extractedColors = palette.map(color => ({
            rgb: color,
            hex: rgbToHex(color[0], color[1], color[2])
          }));
          
          displayColorPalette();
          createThemeMapping();
          
          // Auto-assign theme colors
          // Séquencer l'auto-assignment après l'affichage
          colorPalette.classList.remove('hide');
          themeAssignment.classList.remove('hide');
          
          setTimeout(() => {
            autoAssignThemeColors();
          }, 200);
        } catch (error) {
          console.error('Error extracting colors:', error);
        }
      }
      
      function displayColorPalette() {
        colorSwatches.innerHTML = '';
        extractedColors.forEach((color, index) => {
          const swatch = document.createElement('div');
          swatch.style.cssText = `
            width: 80px;
            height: 80px;
            background-color: ${color.hex};
            border-radius: 8px;
            position: relative;
          `;
          
          const label = document.createElement('span');
          label.textContent = color.hex;
          label.style.cssText = `
            position: absolute;
            bottom: -20px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 10px;
            color: var(--dark);
          `;
          
          swatch.appendChild(label);
          colorSwatches.appendChild(swatch);
        });
      }
      
      function createThemeMapping() {
        const themeVars = ['brand', 'accent', 'extra', 'dark', 'light'];
        themeMapping.innerHTML = '';
        themeVars.forEach(varName => {
          const mapping = document.createElement('div');
          mapping.className = 'theme-mapping-item';
          mapping.style.cssText = `
            display: flex;
            flex-direction: column;
            gap: 16px;
            padding: 16px;
            background-color: var(--light);
            border-radius: 12px;
            border: 1px solid var(--brand__);
            transition: all 0.3s ease;
          `;
          
          // Header with color name and color box
          const header = document.createElement('div');
          header.style.cssText = `
            display: flex;
            align-items: center;
            gap: 16px;
            cursor: pointer;
          `;
          
          const label = document.createElement('span');
          label.textContent = varName;
          label.style.cssText = `
            font-size: 14px;
            font-weight: bold;
            color: var(--dark);
            width: 60px;
          `;
          
          const colorBox = document.createElement('div');
          colorBox.id = `theme-${varName}`;
          colorBox.style.cssText = `
            width: 64px;
            height: 64px;
            border-radius: 6px;
            border: 2px solid var(--brand);
            background-color: var(--${varName});
            cursor: pointer;
            transition: all 0.3s ease;
          `;
          
          // Controls section
          const controls = document.createElement('div');
          controls.id = `controls-${varName}`;
          controls.className = 'theme-controls hide';
          controls.style.cssText = `
            display: flex;
            flex-direction: column;
            gap: 16px;
          `;
          
          // Lightness slider
          const lightnessContainer = document.createElement('div');
          lightnessContainer.style.cssText = `
            display: flex;
            align-items: center;
            gap: 16px;
          `;
          
          const lightnessLabel = document.createElement('span');
          lightnessLabel.textContent = 'L:';
          lightnessLabel.style.cssText = `
            font-size: 11px;
            font-weight: bold;
            color: var(--dark);
            width: 15px;
          `;
          
          const lightnessSlider = document.createElement('input');
          lightnessSlider.type = 'range';
          lightnessSlider.min = '0';
          lightnessSlider.max = '100';
          lightnessSlider.value = '50';
          lightnessSlider.className = 'color-slider';
          lightnessSlider.id = `lightness-${varName}`;
          
          const lightnessValue = document.createElement('span');
          lightnessValue.id = `lightness-value-${varName}`;
          lightnessValue.textContent = '50%';
          lightnessValue.style.cssText = `
            font-size: 10px;
            color: var(--dark);
            width: 30px;
          `;
          
          lightnessContainer.appendChild(lightnessLabel);
          lightnessContainer.appendChild(lightnessSlider);
          lightnessContainer.appendChild(lightnessValue);
          
          // Chroma slider
          const chromaContainer = document.createElement('div');
          chromaContainer.style.cssText = `
            display: flex;
            align-items: center;  
            gap: 16px;
          `;
          
          const chromaLabel = document.createElement('span');
          chromaLabel.textContent = 'C:';
          chromaLabel.style.cssText = `
            font-size: 11px;
            font-weight: bold;
            color: var(--dark);
            width: 15px;
          `;
          
          const chromaSlider = document.createElement('input');
          chromaSlider.type = 'range';
          chromaSlider.min = '0';
          chromaSlider.max = '40';
          chromaSlider.value = '10';
          chromaSlider.className = 'color-slider';
          chromaSlider.id = `chroma-${varName}`;
          
          const chromaValue = document.createElement('span');
          chromaValue.id = `chroma-value-${varName}`;
          chromaValue.textContent = '0.1';
          chromaValue.style.cssText = `
            font-size: 10px;
            color: var(--dark);
            width: 30px;
          `;
          
          chromaContainer.appendChild(chromaLabel);
          chromaContainer.appendChild(chromaSlider);
          chromaContainer.appendChild(chromaValue);
          
          // Add slider events
          lightnessSlider.addEventListener('input', (e) => updateColorLive(varName, 'lightness', e.target.value));
          chromaSlider.addEventListener('input', (e) => updateColorLive(varName, 'chroma', e.target.value));
          
          // Add click event to header to open color picker
          header.addEventListener('click', () => openColorPicker(varName));
          
          // Assemble the mapping
          header.appendChild(label);
          header.appendChild(colorBox);
          controls.appendChild(lightnessContainer);
          controls.appendChild(chromaContainer);
          mapping.appendChild(header);
          mapping.appendChild(controls);
          themeMapping.appendChild(mapping);
        });
      }
      
      let selectedThemeVar = null;
      let currentPickerVar = null;
      
      // Color picker modal elements
      const colorPickerModal = document.getElementById('color-picker-modal');
      const pickerTitle = document.getElementById('picker-title');
      const closePicker = document.getElementById('close-picker');
      const colorPickerSwatches = document.getElementById('color-picker-swatches');
      
      function openColorPicker(varName) {
        currentPickerVar = varName;
        pickerTitle.textContent = `Select color for ${varName}`;

        // Populate color picker with extracted colors
        colorPickerSwatches.innerHTML = '';
        extractedColors.forEach((color, index) => {
          const swatch = document.createElement('div');
          swatch.className = 'picker-swatch';
          swatch.style.cssText = `
            width: 80px;
            height: 80px;
            background-color: ${color.hex};
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 3px solid transparent;
            position: relative;
          `;
          
          const label = document.createElement('span');
          label.textContent = color.hex;
          label.style.cssText = `
            position: absolute;
            bottom: -20px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 10px;
            color: var(--dark);
            font-weight: bold;
          `;
          
          swatch.appendChild(label);
          swatch.addEventListener('click', () => selectColorForTheme(color, varName));
          colorPickerSwatches.appendChild(swatch);
        });

        colorPickerModal.classList.remove('hide');
      }
      
      function closeColorPicker() {
        colorPickerModal.classList.add('hide');
        currentPickerVar = null;
      }
      
      function selectColorForTheme(color, varName) {
        themeColors[varName] = color;
        const themeBox = document.getElementById(`theme-${varName}`);

        closeColorPicker();

        // Apply only this specific color immediately
        const oklch = hexToOklchWrapper(color.hex);
        document.body.style.setProperty(`--${varName}-hue`, oklch.h);
        document.body.style.setProperty(`--${varName}-chroma`, oklch.c);
        document.body.style.setProperty(`--${varName}-lightness`, `${oklch.l}%`);

        // Rebuild root color variable
        const rootColor = `var(--${varName}-lightness) var(--${varName}-chroma) var(--${varName}-hue)`;
        document.body.style.setProperty(`--root-${varName}`, rootColor);

        // Update theme box with CSS variable
        themeBox.style.backgroundColor = `var(--${varName})`;

        // Update sliders with the new color values
        updateSliders(varName, oklch);

        // Show controls
        const controls = document.getElementById(`controls-${varName}`);
        controls.classList.remove('hide');

        // Updated color variables

        // Generate theme for display
        generateTheme();
      }
      
      function updateSliders(varName, oklch) {
        const lightnessSlider = document.getElementById(`lightness-${varName}`);
        const chromaSlider = document.getElementById(`chroma-${varName}`);
        const lightnessValue = document.getElementById(`lightness-value-${varName}`);
        const chromaValue = document.getElementById(`chroma-value-${varName}`);

        if (lightnessSlider) {
          lightnessSlider.value = oklch.l;
          lightnessValue.textContent = `${oklch.l}%`;
        }

        if (chromaSlider) {
          chromaSlider.value = oklch.c * 100;
          chromaValue.textContent = oklch.c.toFixed(3);
        }
      }
      
      function updateColorLive(varName, property, value) {
        const currentHue = document.body.style.getPropertyValue(`--${varName}-hue`) || 0;
        const currentChroma = document.body.style.getPropertyValue(`--${varName}-chroma`) || 0.1;
        const currentLightness = document.body.style.getPropertyValue(`--${varName}-lightness`) || '50%';

        let newHue = parseFloat(currentHue);
        let newChroma = parseFloat(currentChroma);
        let newLightness = parseFloat(currentLightness);

        if (property === 'lightness') {
          newLightness = parseFloat(value);
          document.body.style.setProperty(`--${varName}-lightness`, `${newLightness}%`);
          document.getElementById(`lightness-value-${varName}`).textContent = `${newLightness}%`;
        } else if (property === 'chroma') {
          newChroma = parseFloat(value) / 100;
          document.body.style.setProperty(`--${varName}-chroma`, newChroma);
          document.getElementById(`chroma-value-${varName}`).textContent = newChroma.toFixed(3);
        }

        // Rebuild root color variable
        const rootColor = `var(--${varName}-lightness) var(--${varName}-chroma) var(--${varName}-hue)`;
        document.body.style.setProperty(`--root-${varName}`, rootColor);

        // Live color update applied
      }
      
      function autoAssignThemeColors() {
        if (extractedColors.length === 0) return;

        // Auto-assigning theme colors

        // Convert all colors to OKLCH for analysis
        const colorsWithOklch = extractedColors.map((color, index) => ({
          ...color,
          oklch: hexToOklchWrapper(color.hex),
          dominance: index // ColorThief returns colors by dominance
        }));

        // Processing colors with OKLCH

        // Find BRAND: highest chroma (most vibrant color)
        const brandColor = colorsWithOklch
          .sort((a, b) => b.oklch.c - a.oklch.c)[0];

        // Selected BRAND (highest chroma)

        // Find ACCENT: second highest chroma, excluding brand
        const accentColor = colorsWithOklch
          .filter(c => c !== brandColor)
          .sort((a, b) => b.oklch.c - a.oklch.c)[0];

        // Selected ACCENT (second highest chroma)

        // Find EXTRA: best balance between dominance and hue contrast with brand
        const extraColor = colorsWithOklch
          .filter(c => c !== brandColor && c !== accentColor)
          .sort((a, b) => {
            // Balance between dominance (lower is better) and hue difference (higher is better)
            const aScore = a.dominance - (Math.abs(a.oklch.h - brandColor.oklch.h) / 20);
            const bScore = b.dominance - (Math.abs(b.oklch.h - brandColor.oklch.h) / 20);
            return aScore - bScore;
          })[0];

        // Selected EXTRA (balanced dominance + hue contrast)

        // Apply color assignments
        if (brandColor) applyColorToTheme('brand', brandColor);
        if (accentColor) applyColorToTheme('accent', accentColor);
        if (extraColor) applyColorToTheme('extra', extraColor);

        // Smart Dark/Light based on brand-hue and image analysis
        if (brandColor) {
          setupSmartDarkLight(colorsWithOklch, brandColor);
        }

        // Auto assignments completed
        generateTheme();
      }
      
      function setupSmartDarkLight(colorsWithOklch, brandColor) {
        // Analyze image to determine if it's mostly dark or light
        const avgLightness = colorsWithOklch.reduce((sum, c) => sum + c.oklch.l, 0) / colorsWithOklch.length;
        // Average image lightness calculated

        // Find darkest and lightest colors for reference
        const darkestColor = colorsWithOklch.sort((a, b) => a.oklch.l - b.oklch.l)[0];
        const lightestColor = colorsWithOklch.sort((a, b) => b.oklch.l - a.oklch.l)[0];

        // Keep default EVA CSS values for current-darkness/lightness
        // Don't modify these to preserve theme toggle functionality
        // Keeping default --current-darkness and --current-lightness values for theme toggle

        // Setup DARK using brand-hue
        document.body.style.setProperty('--dark-lightness', 'var(--current-darkness)');
        document.body.style.setProperty('--dark-chroma', '0.05');
        document.body.style.setProperty('--dark-hue', 'var(--brand-hue)');

        // Setup LIGHT using brand-hue
        document.body.style.setProperty('--light-lightness', 'var(--current-lightness)');
        document.body.style.setProperty('--light-chroma', '0.01');
        document.body.style.setProperty('--light-hue', 'var(--brand-hue)');

        // Rebuild root variables
        document.body.style.setProperty('--root-dark', 'var(--dark-lightness) var(--dark-chroma) var(--dark-hue)');
        document.body.style.setProperty('--root-light', 'var(--light-lightness) var(--light-chroma) var(--light-hue)');

        // Update sliders for dark/light using default EVA values
        updateSliders('dark', { 
          l: 15, // Default EVA CSS dark value
          c: 0.05, 
          h: brandColor.oklch.h 
        });

        updateSliders('light', { 
          l: 90, // Default EVA CSS light value
          c: 0.01, 
          h: brandColor.oklch.h 
        });

        // Show controls
        const darkControls = document.getElementById('controls-dark');
        const lightControls = document.getElementById('controls-light');
        if (darkControls) darkControls.classList.remove('hide');
        if (lightControls) lightControls.classList.remove('hide');

        // Update theme colors object
        themeColors.dark = { hex: `oklch(15% 0.05 ${brandColor.oklch.h})`, oklch: { l: 15, c: 0.05, h: brandColor.oklch.h } };
        themeColors.light = { hex: `oklch(90% 0.01 ${brandColor.oklch.h})`, oklch: { l: 90, c: 0.01, h: brandColor.oklch.h } };
      }
      
      function applyColorToTheme(varName, colorData) {
        const oklch = colorData.oklch;

        // Update theme variables
        document.body.style.setProperty(`--${varName}-hue`, oklch.h);
        document.body.style.setProperty(`--${varName}-chroma`, oklch.c);
        document.body.style.setProperty(`--${varName}-lightness`, `${oklch.l}%`);

        // Rebuild root color variable
        const rootColor = `var(--${varName}-lightness) var(--${varName}-chroma) var(--${varName}-hue)`;
        document.body.style.setProperty(`--root-${varName}`, rootColor);

        // Update theme colors object
        themeColors[varName] = colorData;

        // Update sliders
        updateSliders(varName, oklch);

        // Show controls
        const controls = document.getElementById(`controls-${varName}`);
        if (controls) {
          controls.classList.remove('hide');
        }

        // Auto-applied color
      }
      
      
      // Close picker events
      closePicker.addEventListener('click', closeColorPicker);
      colorPickerModal.addEventListener('click', (e) => {
        if (e.target === colorPickerModal || e.target.classList.contains('color-picker-overlay')) {
          closeColorPicker();
        }
      });
      
      function generateTheme() {
        // Get actual CSS variables from document.body
        const themeVars = ['brand', 'accent', 'extra', 'dark', 'light'];
        const css = themeVars
          .filter(varName => {
            // Check if this variable exists in the body
            const hue = document.body.style.getPropertyValue(`--${varName}-hue`);
            return hue !== '';
          })
          .map(varName => {
            const lightness = document.body.style.getPropertyValue(`--${varName}-lightness`);
            const chroma = document.body.style.getPropertyValue(`--${varName}-chroma`);
            const hue = document.body.style.getPropertyValue(`--${varName}-hue`);
            return `
  --${varName}-lightness: ${lightness};
  --${varName}-chroma: ${chroma};
  --${varName}-hue: ${hue};`;
          })
          .join('\n');

        const fullCss = `.theme-auto {${css}
}`;

        // Generated CSS
        themeCss.textContent = fullCss;
        generatedTheme.classList.remove('hide');
      }
      
      function applyThemeToPage() {
        // Just update the CSS variables directly on body
        Object.entries(themeColors).forEach(([varName, color]) => {
          if (color !== null) {
            const oklch = hexToOklch(color.hex);
            document.body.style.setProperty(`--${varName}-hue`, oklch.h);
            document.body.style.setProperty(`--${varName}-chroma`, oklch.c);
            document.body.style.setProperty(`--${varName}-lightness`, `${oklch.l}%`);
            
            // Updated color variables
          }
        });
      }
      
      function hexToOklchWrapper(hex) {
        try {
          const result = hexToOklch(hex);
          // Converting hex to OKLCH
          return result;
        } catch (error) {
          console.error('Error converting to OKLCH:', error);
          return { l: 50, c: 0.1, h: 0 };
        }
      }
      
      function rgbToHex(r, g, b) {
        return "#" + ((1 << 24) + (r << 16) + (g << 8) + b).toString(16).slice(1);
      }
      
      // Copy theme to clipboard
      copyTheme.addEventListener('click', () => {
        navigator.clipboard.writeText(themeCss.textContent).then(() => {
          copyTheme.textContent = 'Copied!';
          setTimeout(() => {
            copyTheme.textContent = 'Copy CSS';
          }, 2000);
        });
      });
      
      // Reset theme
      const resetTheme = document.getElementById('reset-theme');
      resetTheme.addEventListener('click', () => {
        // Reset all theme colors
        themeColors = {
          brand: null,
          accent: null,
          extra: null,
          dark: null,
          light: null
        };

        // Reset visual boxes
        const themeVars = ['brand', 'accent', 'extra', 'dark', 'light'];
        themeVars.forEach(varName => {
          const themeBox = document.getElementById(`theme-${varName}`);
          if (themeBox) {
            themeBox.style.backgroundColor = `var(--${varName})`;
          }
        });

        // Reset CSS variables to EVA defaults
        const defaultValues = {
          brand: { hue: 169, chroma: 0.108, lightness: 62.8 },
          accent: { hue: 10, chroma: 0.258, lightness: 54.5 },
          extra: { hue: 200, chroma: 0.181, lightness: 78.0 },
          dark: { hue: 0, chroma: 0, lightness: 26.4 },
          light: { hue: 0, chroma: 0, lightness: 96.4 }
        };

        Object.entries(defaultValues).forEach(([varName, values]) => {
          document.body.style.setProperty(`--${varName}-hue`, values.hue);
          document.body.style.setProperty(`--${varName}-chroma`, values.chroma);
          document.body.style.setProperty(`--${varName}-lightness`, `${values.lightness}%`);
          
          // Rebuild root color variable
          const rootColor = `var(--${varName}-lightness) var(--${varName}-chroma) var(--${varName}-hue)`;
          document.body.style.setProperty(`--root-${varName}`, rootColor);
        });

        // Hide generated theme section
        generatedTheme.classList.add('hide');

        resetTheme.textContent = 'Reset!';
        setTimeout(() => {
          resetTheme.textContent = 'Reset Theme';
        }, 2000);
      });
    });
  </script>
  
  <style>
    .hide {
      display: none !important;
    }
    
    
    .theme-mapping-item:hover {
      background-color: var(--brand___) !important;
      border-color: var(--brand) !important;
    }
    
    .theme-controls {
      margin-top: 8px;
      padding-top: 8px;
      border-top: 1px solid var(--brand__);
    }
    
    #drop-zone:hover {
      border-color: var(--accent) !important;
      background-color: var(--accent___) !important;
    }
    
    /* Color Picker Modal */
    .color-picker-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 1000;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .color-picker-overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(4px);
    }
    
    .color-picker-content {
      position: relative;
      background-color: var(--light);
      border-radius: 16px;
      padding: 32px;
      max-width: 600px;
      width: 90%;
      max-height: 80vh;
      overflow-y: auto;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
      border: 1px solid var(--brand__);
    }
    
    .picker-swatch:hover {
      transform: scale(1.1);
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
      border-color: var(--brand) !important;
    }
    
    #close-picker {
      background: none;
      border: none;
      cursor: pointer;
      font-size: 24px;
      padding: 8px;
      border-radius: 8px;
      transition: all 0.3s ease;
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    #close-picker:hover {
      background-color: var(--brand__);
      color: var(--brand);
      transform: scale(1.1);
    }
    
    /* Color sliders */
    .color-slider {
      -webkit-appearance: none;
      appearance: none;
      width: 100%;
      height: 4px;
      border-radius: 2px;
      background: linear-gradient(to right, var(--light), var(--dark));
      outline: none;
      cursor: pointer;
    }
    
    .color-slider::-webkit-slider-track {
      -webkit-appearance: none;
      appearance: none;
      height: 4px;
      border-radius: 2px;
      background: linear-gradient(to right, var(--light), var(--dark));
    }
    
    .color-slider::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background: var(--dark);
      cursor: pointer;
      border: 4px solid var(--light);
      box-shadow: 0 4px 8px rgba(0,0,0,0.3);
      transition: all 0.2s ease;
    }
    
    .color-slider::-webkit-slider-thumb:hover {
      transform: scale(1.15);
      box-shadow: 0 6px 12px rgba(0,0,0,0.4);
      background: var(--light);
      border: 4px solid var(--dark);
    }
    
    .color-slider::-moz-range-track {
      width: 100%;
      height: 4px;
      border-radius: 2px;
      background: linear-gradient(to right, var(--light), var(--dark));
      border: none;
    }
    
    .color-slider::-moz-range-thumb {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background: var(--dark);
      cursor: pointer;
      border: 4px solid var(--light);
      box-shadow: 0 4px 8px rgba(0,0,0,0.3);
      transition: all 0.2s ease;
    }
    
    .color-slider::-moz-range-thumb:hover {
      transform: scale(1.15);
      box-shadow: 0 6px 12px rgba(0,0,0,0.4);
      background: var(--light);
      border: 4px solid var(--dark);
    }
  </style>
  </body>
</html>